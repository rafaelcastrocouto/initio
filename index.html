<!DOCTYPE HTML>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Language" content="en-US" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0">
  <meta name="Author" content="Rafael Castro Couto, rafaelcastrocouto@gmail.com">
  <style>canvas{float: left;}</style>
</head>
<body>
  
<div id="controls">
  <span>Fibo:</span><input type="text" id="F" value="5" size="3"/>
  <span>Seq:</span><input type="text" id="seq" value="BABABBAB"/>
  <span>ELA:</span><input type="text" id="E" value="1000" size="3"/>
  <span>Annealing:</span><input type="text" id="A" value="1000" size="3"/>
  <span>Repeat:</span><input type="text" id="N" value="3" size="3"/>
  <span>Render:</span><input type="checkbox" id="R" checked/>
  <span>Chart:</span><input type="checkbox" id="C" checked/>
  <button id="start">Start</button><br>
  <span>Eff:</span><input type="text" id="Eff" disabled size="30"/>
  <span>Rig:</span><input type="text" id="Rig" disabled size="30"/>
</div>  
  
<div id="results"></div>  

<div id="canvas"></div> 
  
<script type="text/javascript" src="utils.js"></script>
<script type="text/javascript" src="protein.js"></script>
<script type="text/javascript" src="energy.js"></script>
<script type="text/javascript" src="ela.js"></script>
<script type="text/javascript" src="ann.js"></script>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="highcharts.js"></script>
<script type="text/javascript" src="exporting.js"></script>
<script type="text/javascript" src="print.js"></script>

<script type="text/javascript">
  
var seq = 'AB';
var ang = [];  
  
var sum_tests = 0;
var test_count = 0;

var test_av = function(e){
  $('#controls input').attr('disabled', true);
  if(e) sum_tests += e.energy;
  //limit
  var _l = parseInt($('#N').val());
  
  if(test_count < _l) {
    var p = new Protein({'seq': seq, 'ang': ang});
    p.render();
    f_data = [0]; 
    e_data = [p.energy];
    Ela(p, p.context);
  } else {
    $('#results').append($('<p>Avarage('+test_count+'): '+(sum_tests/test_count)+'</p>'));
    $('#controls input').attr('disabled', false);
  }
  ++test_count;
};
  
var render = true;  
var toggle_render = function(){
  render = !render;
};

var print_chart = true;  
var toggle_chart = function(){
  print_chart = !print_chart;
};  

//DATA
var f_data, e_data;

var pushToData = function(fail_count, min_p){
  f_data.push(fail_count);
  e_data.push({y: min_p.energy, marker: { p: min_p }});
};
  
var gen_fibo_seq = function(){
  var n = parseInt($(this).val());  
  $('#seq').val(fibonacci(n));
};  
  
var load = function(){
  
  $('#start').on('click', function(){
    seq = $('#seq').val();  
    ang = [];
    var i = seq.length;  
    while(i) ang[--i] = 0;    
    $('#results').html('');
    $('#canvas').html('');
    sum_tests = 0;
    test_count = 0;
    test_av();
  });
  $('#R').on('click', toggle_render);
  $('#C').on('click', toggle_chart);
  $('#F').on('change', gen_fibo_seq);
}; $(load);    
    
</script>
  
</body>
</html>