<!DOCTYPE HTML>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Language" content="en-US" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0">
  <meta name="Author" content="Rafael Castro Couto, rafaelcastrocouto@gmail.com">
  <style>canvas{float: left;}</style>
</head>
<body>
  
<div id="controls">
  <span>Fibo:</span><input type="text" id="F" value="6" size="3" class="e"/>
  <span>Seq:</span><input type="text" id="seq" class="e"/>
  <span>ELA:</span><input type="text" id="E" value="500" size="3" class="e"/>
  <span>Annealing:</span><input type="text" id="A" value="200" size="3" class="e"/>
  <span>Repeat:</span><input type="text" id="N" value="30" size="3" class="e"/>
  <span>Render All:</span><input type="checkbox" id="R" class="e"/>
  <span>Chart All:</span><input type="checkbox" id="C" class="e"/>
  <span>Global Parameters:</span><input type="checkbox" id="GP" checked class="e"/>
  <input id="start" type="button" value="Start" class="e"/><br>
  <span>Eff:</span><input type="text" id="Eff" disabled size="30"/>
  <span>Rig:</span><input type="text" id="Rig" disabled size="30"/>
  <span>Steps:</span><input type="text" id="St" disabled size="3"/>
  <span>Progress:</span><input type="text" id="Prog" value="0%" disabled size="3"/>
</div>  
  
<div id="results"></div>  

<div id="canvas"></div> 
  
<script type="text/javascript" src="utils.js"></script>
<script type="text/javascript" src="protein.js"></script>
<script type="text/javascript" src="energy.js"></script>
<script type="text/javascript" src="ela.js"></script>
<script type="text/javascript" src="ann.js"></script>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="highcharts.js"></script>
<script type="text/javascript" src="exporting.js"></script>
<script type="text/javascript" src="print.js"></script>

<script type="text/javascript">
  
var seq = 'AB';
var ang = [];  
var N;
var sum_tests = 0;
var test_count = 0;
var the_min = {energy: Infinity};
var steps = 0;
var St, Prog, Tprog;
  
var test_av = function(P){
  if(P) {
    sum_tests += P.energy;
    if(P.energy < the_min.energy) the_min = P;    
  }
  //limit
  steps = St;
  if(test_count < N) {
    var p = new Protein({'seq': seq, 'ang': ang});
    p.render();
    f_data = [0]; 
    e_data = [p.energy];
    Ela(p, p.context);
  } else {
    $('#results').append($('<p>Avarage(Sum/'+test_count+'): '+(sum_tests/test_count)+'</p>'));
    $('#results').append($('<p>Min: '+the_min.energy+'</p>'));
    render = true;
    final_chart(fe_array);
    the_min.render();
    console.log(the_min);
    $('#controls > input.e').attr('disabled', false);
  }
  ++test_count;
};
  
var render = !$('#R').val();  
var toggle_render = function(){
  render = !render;
};

var print_chart = !$('#C').val();  
var toggle_chart = function(){
  print_chart = !print_chart;
};  

var st_in = $('#St'); 
var pr_in = $('#Prog');  
  
//DATA
var f_data, e_data;
var fe_array = [];
var pushToData = function(fail_count, min_p){
  f_data.push(fail_count);
  e_data.push({y: min_p.energy/*, marker: { p: min_p }*/});
};
  
var gen_fibo_seq = function(){
  var n = parseInt($('#F').val());  
  $('#seq').val(fibonacci(n));
};  
  
var load = function(){
  gen_fibo_seq();
  $('#start').on('click', function(){
    seq = $('#seq').val();  
    ang = [];
    var i = seq.length;  
    while(i) ang[--i] = 0;     
    St = parseInt($('#E').val()) + parseInt($('#A').val());
    st_in.val(St);
    Prog = 0;
    N = parseInt($('#N').val());
    Tprog = St * N /100;
    pr_in.val('0%')
    $('#results').html('');
    $('#canvas').html('');
    sum_tests = 0;
    test_count = 0;
    the_min = {energy: Infinity};
    $('#controls > input.e').attr('disabled', true);
    test_av();
  });
  $('#R').on('click', toggle_render);
  $('#C').on('click', toggle_chart);
  $('#F').on('change', gen_fibo_seq);
}; $(load);    
    
</script>
  
</body>
</html>